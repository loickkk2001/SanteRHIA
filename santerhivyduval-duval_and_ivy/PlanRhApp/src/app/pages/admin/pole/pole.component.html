<div class="dashboard-container md:p-6 p-4">
  <p-toast></p-toast>
  <p class="dashboard-title text-2xl md:text-3xl font-bold mb-6">GESTIONS DES POLES</p>
  <div class="flex justify-end py-5">
    <p-drawer [(visible)]="poleVisible" position="right" [header]="isEditMode ? 'Modifier un pôle' : 'Ajouter un pôle'">
      <form [formGroup]="poleForm" class="flex flex-col gap-2">
        <p-iftalabel>
          <input pInputText id="name" autocomplete="off" formControlName="name" class="uniform-input"/>
          <label for="name">Nom</label>
        </p-iftalabel>
        <div class="h-5"></div>
        <p-iftalabel>
          <p-select formControlName="head" [options]="cadreUsers" optionLabel="first_name" placeholder="Sélectionner un responsable" class="w-full md:w-56 uniform-input"/>
          <label for="name">Responsable</label>
        </p-iftalabel>
        <div class="h-5"></div>
        <p-iftalabel>
          <p-multiSelect id="poleSpecialities" formControlName="specialities" [options]="specialityOptions" optionLabel="label" optionValue="value" placeholder="Sélectionnez les spécialités" [filter]="true" display="chip" class="w-full md:w-56 uniform-input"></p-multiSelect>
          <label for="poleSpecialities">Spécialités</label>
        </p-iftalabel>
        <p-button (click)="isEditMode ? updatePole() : onSubmitPole()" severity="contrast" class="mt-5">
          {{ isEditMode ? 'Mettre à jour' : 'Créer un nouveau pôle' }}
        </p-button>
      </form>
    </p-drawer>
    <p-button (click)="showAddDialogPole()" severity="contrast">Ajouter un pôle</p-button>
  </div>

  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <div class="flex-1">
      <span class="p-input-icon-left w-full">
        <input pInputText type="text" [(ngModel)]="searchTermPole" (input)="applyFilter()" placeholder="Rechercher par matricule, nom ou responsable..." class="w-full border border-gray-300 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors h-11">
      </span>
    </div>
  </div>

  <div class="table-container overflow-x-auto" style="border-radius: 0.75rem;">
    <p-table [value]="filteredPole" [paginator]="true" [rows]="rows" [totalRecords]="totalRecords" [lazy]="false" (onPage)="onPageChange($event)" [tableStyle]="{ 'min-width': '100%' }" responsiveLayout="scroll" class="w-full">
      <ng-template pTemplate="header">
        <tr>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Matricule</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Nom</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Responsable</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Spécialités</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-poles>
        <tr class="table-row hover:bg-gray-50">
          <td class="p-3 border-b">{{ poles.matricule }}</td>
          <td class="p-3 border-b">{{ poles.name }}</td>
          <td class="p-3 border-b">{{ poles.head }}</td>
          <td class="p-3 border-b">
            <span *ngFor="let spec of poles.specialities; let last = last">
              <p-badge [value]="spec.name" [severity]="'secondary'" styleClass="p-mr-2"></p-badge>{{last ? '' : ' '}}
            </span>
          </td>
          <td class="space-x-3">
            <i class="pi pi-pencil cursor-pointer text-blue-500 hover:text-blue-700" (click)="showEditDialogPole(poles)"></i>
            <i class="pi pi-trash cursor-pointer text-red-500 hover:text-red-700" (click)="confirmDeletePole(poles)"></i>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [colSpan]="5" class="text-center py-4">Aucun pôle</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog header="Confirmation de suppression" [(visible)]="deletePoleDialog" [style]="{width: '450px'}" [modal]="true">
    <div class="confirmation-content">
      <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
      <span>Êtes-vous sûr de vouloir supprimer ce pôle?</span>
    </div>
    <ng-template pTemplate="footer">
      <p-button icon="pi pi-times" (click)="deletePoleDialog = false" label="Annuler" styleClass="p-button-secondary"></p-button>
      <p-button icon="pi pi-check" (click)="deletePole()" label="Supprimer" styleClass="p-button-danger"></p-button>
    </ng-template>
  </p-dialog>
</div>
