<div class="dashboard-container md:p-6 p-4">
  <p-toast></p-toast>
  <p class="dashboard-title text-2xl md:text-3xl font-bold mb-6">GESTIONS DES SERVICES</p>
  <div class="flex justify-end py-5">
    <p-drawer [(visible)]="serviceVisible" position="right" [header]="isEditMode ? 'Modifier un service' : 'Ajouter un service'">
      <form [formGroup]="serviceForm" class="flex flex-col gap-2">
        <p-iftalabel>
          <input pInputText id="name" autocomplete="off" formControlName="name" class="uniform-input"/>
          <label for="name">Nom</label>
        </p-iftalabel>
        <div class="h-5"></div>
        <p-iftalabel>
          <p-select formControlName="head" [options]="cadreUsers" [filter]="true" optionLabel="first_name" placeholder="Sélectionner un responsable" class="w-full md:w-56 uniform-input"/>
          <label for="name">Responsable</label>
        </p-iftalabel>
        <p-button (click)="isEditMode ? updateService() : onSubmit()" severity="contrast" class="mt-5">
          {{ isEditMode ? 'Mettre à jour' : 'Créer un nouveau service' }}
        </p-button>
      </form>
    </p-drawer>
    <p-button (click)="showAddDialog()" severity="contrast">Ajouter un Service</p-button>
  </div>

  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <div class="flex-1">
      <span class="p-input-icon-left w-full">
        <input pInputText type="text" [(ngModel)]="searchTermService" (input)="applyFilter()" placeholder="Rechercher par matricule, nom ou responsable..." class="w-full border border-gray-300 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors h-11">
      </span>
    </div>
  </div>

  <div class="table-container overflow-x-auto" style="border-radius: 0.75rem;">
    <p-table [value]="filteredService" [paginator]="true" [rows]="rows" [totalRecords]="totalRecords" [lazy]="false" (onPage)="onPageChange($event)" [tableStyle]="{ 'min-width': '100%' }" responsiveLayout="scroll" class="w-full">
      <ng-template pTemplate="header">
        <tr>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Matricule</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Nom</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Responsable</th>
          <th style="background-color: #e5e7eb; padding: 1rem; font-weight: 600; color: #374151">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-service>
        <tr class="table-row hover:bg-gray-50">
          <td class="p-3 border-b">{{ service.matricule }}</td>
          <td class="p-3 border-b">{{ service.name }}</td>
          <td class="p-3 border-b">{{ service.head }}</td>
          <td class="space-x-3">
            <i class="pi pi-pencil cursor-pointer text-blue-500 hover:text-blue-700" (click)="showEditDialog(service)"></i>
            <i class="pi pi-trash cursor-pointer text-red-500 hover:text-red-700" (click)="confirmDelete(service)"></i>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [colSpan]="4" class="text-center py-4">Aucun service</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog header="Confirmation de suppression" [(visible)]="deleteServiceDialog" [style]="{width: '450px'}" [modal]="true">
    <div class="confirmation-content">
      <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
      <span>Êtes-vous sûr de vouloir supprimer ce service?</span>
    </div>
    <ng-template pTemplate="footer">
      <p-button icon="pi pi-times" (click)="deleteServiceDialog = false" label="Annuler" styleClass="p-button-secondary"></p-button>
      <p-button icon="pi pi-check" (click)="deleteService()" label="Supprimer" styleClass="p-button-danger"></p-button>
    </ng-template>
  </p-dialog>
</div>
