<div class="custom-calendar">
  <!-- Header avec navigation -->
  <div class="calendar-header">
    <button
      type="button"
      class="nav-button"
      (click)="previousMonth()"
      aria-label="Mois précédent"
    >
      ‹
    </button>
    <h3 class="month-year">{{ currentMonth }}</h3>
    <button
      type="button"
      class="nav-button"
      (click)="nextMonth()"
      aria-label="Mois suivant"
    >
      ›
    </button>
  </div>

  <!-- Contrôles d'affichage -->
  <div class="calendar-controls">
    <div class="control-group">
      <button class="control-button" (click)="toggleDisplayOptions()">
        Options d'affichage ▼
      </button>

      <!-- Menu déroulant des options d'affichage -->
      <div class="dropdown-menu" *ngIf="showDisplayOptions">
        <button
          class="dropdown-item"
          (click)="setDisplayMode('monthly')"
          [class.active]="displayMode === 'monthly'"
        >
          Mensuelle
        </button>
        <button
          class="dropdown-item"
          (click)="setDisplayMode('weekly')"
          [class.active]="displayMode === 'weekly'"
        >
          Hebdomadaire
        </button>
        <button
          class="dropdown-item"
          (click)="setDisplayMode('daily')"
          [class.active]="displayMode === 'daily'"
        >
          Journalière
        </button>
      </div>
    </div>

    <div class="control-group">
      <button class="control-button" (click)="toggleMissions()">
        Missions ▼
      </button>

      <!-- Menu déroulant des filtres de missions -->
      <div class="dropdown-menu mission-filters" *ngIf="showMissionFilters">
        <div class="filter-section">
          <h4>Légende</h4>
          <div class="filter-item">
            <input
              type="checkbox"
              id="disponibiliteValidee"
              [checked]="missionFilters.disponibiliteValidee"
              (change)="toggleMissionFilter('disponibiliteValidee')"
            />
            <label for="disponibiliteValidee" class="filter-label">
              <span class="color-indicator" style="background: #10b981"></span>
              Disponibilité validée
            </label>
          </div>
          <div class="filter-item">
            <input
              type="checkbox"
              id="disponibiliteProposee"
              [checked]="missionFilters.disponibiliteProposee"
              (change)="toggleMissionFilter('disponibiliteProposee')"
            />
            <label for="disponibiliteProposee" class="filter-label">
              <span class="color-indicator" style="background: #3b82f6"></span>
              Disponibilité proposée
            </label>
          </div>
          <div class="filter-item">
            <input
              type="checkbox"
              id="disponibiliteRefusee"
              [checked]="missionFilters.disponibiliteRefusee"
              (change)="toggleMissionFilter('disponibiliteRefusee')"
            />
            <label for="disponibiliteRefusee" class="filter-label">
              <span class="color-indicator" style="background: #ef4444"></span>
              Disponibilité refusée
            </label>
          </div>
          <div class="filter-item">
            <input
              type="checkbox"
              id="soins"
              [checked]="missionFilters.soins"
              (change)="toggleMissionFilter('soins')"
            />
            <label for="soins" class="filter-label">
              <span class="color-indicator" style="background: #8b5cf6"></span>
              Soins
            </label>
          </div>
          <div class="filter-item">
            <input
              type="checkbox"
              id="conge"
              [checked]="missionFilters.conge"
              (change)="toggleMissionFilter('conge')"
            />
            <label for="conge" class="filter-label">
              <span class="color-indicator" style="background: #f59e0b"></span>
              Congé
            </label>
          </div>
          <div class="filter-item">
            <input
              type="checkbox"
              id="repos"
              [checked]="missionFilters.repos"
              (change)="toggleMissionFilter('repos')"
            />
            <label for="repos" class="filter-label">
              <span class="color-indicator" style="background: #06b6d4"></span>
              Repos
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grille du calendrier -->
  <div class="calendar-grid">
    <!-- En-tête vide pour la colonne des semaines -->
    <div class="week-header-empty"></div>

    <!-- En-têtes des jours de la semaine -->
    <div class="day-header" *ngFor="let day of weekDays">{{ day }}</div>

    <!-- Semaines et jours du calendrier -->
    <ng-container *ngFor="let week of getWeeks(); let weekIndex = index">
      <!-- Numéro de semaine -->
      <div class="week-number-cell">Semaine {{ getWeekNumber(week[0]) }}</div>

      <!-- Jours de la semaine -->
      <div
        class="calendar-day"
        *ngFor="let day of week"
        [class.selected]="isSelected(day)"
        [class.today]="isToday(day)"
        [class.other-month]="!isCurrentMonth(day)"
        [class.has-events]="hasEvents(day)"
        [class.has-proposal]="hasProposal(day)"
        [style.background-color]="getEventColor(day)"
        [title]="getEventTooltip(day)"
        [attr.aria-label]="day.toLocaleDateString('fr-FR')"
      >
        <span class="day-number">{{ day.getDate() }}</span>

        <!-- Bouton + pour proposer disponibilité -->
        <button
          class="proposal-button"
          *ngIf="canProposeAvailability(day)"
          (click)="proposeAvailability(day, $event)"
          title="Proposer ma disponibilité"
        >
          +
        </button>

        <!-- Indicateur d'événements -->
        <div class="event-indicator" *ngIf="hasEvents(day)">
          <div class="event-dot"></div>
        </div>

        <!-- Label "Proposé" -->
        <div class="proposal-label" *ngIf="hasProposal(day)">Proposé</div>
      </div>
    </ng-container>
  </div>

  <!-- Barre d'actions (optionnelle) -->
  <div class="calendar-actions" *ngIf="showButtonBar">
    <button
      type="button"
      class="action-button today-button"
      (click)="selectToday()"
    >
      Aujourd'hui
    </button>
    <button
      type="button"
      class="action-button clear-button"
      (click)="clearSelection()"
    >
      Effacer
    </button>
  </div>
</div>
